{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Income Inequality: Top 3 vs Bottom 3 States in Malaysia (2016-2022)",
    "fontSize": 16,
    "font": "Arial",
    "anchor": "start",
    "color": "#333333",
    "dx": 30,
    "dy": 0
  },
  "width": 700,
  "height": 650,
  "data": {
    "url": "https://raw.githubusercontent.com/GurgobindSingh/FIT3179_Assignment2/main/bump_chart_household_income.csv",
    "format": {
      "type": "csv",
      "parse": {
        "income_median": "number",
        "year": "number"
      }
    }
  },
  "transform": [
    {
      "filter": "datum.state == 'Kuala Lumpur' || datum.state == 'Putrajaya' || datum.state == 'Selangor' || datum.state == 'Kelantan' || datum.state == 'Kedah' || datum.state == 'Perak'"
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "income_median", "order": "descending"}],
      "groupby": ["year"],
      "frame": [null, null]
    },
    {
      "calculate": "datum.state == 'Kuala Lumpur' ? 1 : datum.state == 'Putrajaya' ? 2 : datum.state == 'Selangor' ? 3 : datum.state == 'Kelantan' ? 4 : datum.state == 'Kedah' ? 5 : datum.state == 'Perak' ? 6 : 0",
      "as": "highlight"
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "line",
        "point": false,
        "strokeWidth": 2.5
      },
      "encoding": {
        "x": {
          "field": "year",
          "type": "ordinal",
          "title": "Year",
          "axis": {
            "labelAngle": 0,
            "labelFontSize": 12,
            "titleFontSize": 13
          }
        },
        "y": {
          "field": "rank",
          "type": "quantitative",
          "title": "Rank (1=Highest, 6=Lowest Income)",
          "scale": {"domain": [0.5, 6.5], "reverse": true},
          "axis": {
            "tickMinStep": 1,
            "labelFontSize": 11,
            "titleFontSize": 13
          }
        },
        "detail": {
          "field": "state",
          "type": "nominal"
        },
        "color": {
          "condition": [
            {
              "test": "datum.highlight == 1",
              "value": "#B8860B"
            },
            {
              "test": "datum.highlight == 2",
              "value": "#708090"
            },
            {
              "test": "datum.highlight == 3",
              "value": "#8B4513"
            },
            {
              "test": "datum.highlight == 4",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 5",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 6",
              "value": "#000000"
            }
          ],
          "value": "#666666"
        },
        "strokeWidth": {
          "condition": {
            "test": "datum.highlight > 0",
            "value": 3.5
          },
          "value": 2.5
        },
        "tooltip": [
          {"field": "state", "type": "nominal", "title": "State"},
          {"field": "year", "type": "ordinal", "title": "Year"},
          {"field": "rank", "type": "quantitative", "title": "Rank"},
          {
            "field": "income_median",
            "type": "quantitative",
            "title": "Median Household Income (RM)",
            "format": ","
          }
        ]
      }
    },
    {
      "mark": {
        "type": "point",
        "filled": true,
        "size": 100,
        "opacity": 1
      },
      "encoding": {
        "x": {"field": "year", "type": "ordinal"},
        "y": {"field": "rank", "type": "quantitative"},
        "color": {
          "condition": [
            {
              "test": "datum.highlight == 1",
              "value": "#B8860B"
            },
            {
              "test": "datum.highlight == 2",
              "value": "#708090"
            },
            {
              "test": "datum.highlight == 3",
              "value": "#8B4513"
            },
            {
              "test": "datum.highlight == 4",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 5",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 6",
              "value": "#000000"
            }
          ],
          "value": "#666666"
        },
        "size": {
          "condition": {
            "test": "datum.highlight > 0",
            "value": 120
          },
          "value": 100
        },
        "tooltip": [
          {"field": "state", "type": "nominal", "title": "State"},
          {"field": "year", "type": "ordinal", "title": "Year"},
          {"field": "rank", "type": "quantitative", "title": "Rank"},
          {
            "field": "income_median",
            "type": "quantitative",
            "title": "Median Household Income (RM)",
            "format": ","
          }
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "right",
        "dx": -10,
        "fontSize": 10
      },
      "transform": [
        {"filter": "datum.year == 2016"}
      ],
      "encoding": {
        "x": {"field": "year", "type": "ordinal"},
        "y": {"field": "rank", "type": "quantitative"},
        "text": {"field": "state", "type": "nominal"},
        "color": {
          "condition": [
            {
              "test": "datum.highlight == 1",
              "value": "#B8860B"
            },
            {
              "test": "datum.highlight == 2",
              "value": "#708090"
            },
            {
              "test": "datum.highlight == 3",
              "value": "#8B4513"
            },
            {
              "test": "datum.highlight == 4",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 5",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 6",
              "value": "#000000"
            }
          ],
          "value": "#666666"
        }
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "left",
        "dx": 10,
        "fontSize": 10
      },
      "transform": [
        {"filter": "datum.year == 2022"}
      ],
      "encoding": {
        "x": {"field": "year", "type": "ordinal"},
        "y": {"field": "rank", "type": "quantitative"},
        "text": {"field": "state", "type": "nominal"},
        "color": {
          "condition": [
            {
              "test": "datum.highlight == 1",
              "value": "#B8860B"
            },
            {
              "test": "datum.highlight == 2",
              "value": "#708090"
            },
            {
              "test": "datum.highlight == 3",
              "value": "#8B4513"
            },
            {
              "test": "datum.highlight == 4",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 5",
              "value": "#000000"
            },
            {
              "test": "datum.highlight == 6",
              "value": "#000000"
            }
          ],
          "value": "#666666"
        }
      }
    },
    {
      "mark": {
        "type": "rule",
        "strokeWidth": 2,
        "strokeDash": [5, 5],
        "color": "#FF6B6B",
        "opacity": 0.6
      },
      "data": {
        "values": [
          {"year": 2020}
        ]
      },
      "encoding": {
        "x": {"field": "year", "type": "ordinal"}
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "center",
        "dy": -10,
        "fontSize": 10,
        "fontWeight": "bold",
        "color": "#FF6B6B"
      },
      "data": {
        "values": [
          {"year": 2020, "rank": 0.3, "text": "COVID-19 Impact"}
        ]
      },
      "encoding": {
        "x": {"field": "year", "type": "ordinal"},
        "y": {"field": "rank", "type": "quantitative"},
        "text": {"field": "text", "type": "nominal"}
      }
    }
  ],
  "config": {
    "view": {"stroke": null},
    "axis": {"grid": true, "gridOpacity": 0.3}
  }
}
