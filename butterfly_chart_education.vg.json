{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Grouped bar chart showing average education completion rates for male and female across different education stages",
  "vconcat": [
    {
      "width": 500,
      "height": 40,
      "data": {
        "values": [
          {"text": "Average Education Completion Rates ", "x": 10, "color": "#000000"},
          {"text": "Male", "x": 265, "color": "#4A90E2"},
          {"text": " vs ", "x": 300, "color": "#000000"},
          {"text": "Female", "x": 319, "color": "#E94B8A"},
          {"text": " (2016-2022)", "x": 370, "color": "#000000"}
        ]
      },
      "mark": {
        "type": "text",
        "fontSize": 14,
        "fontWeight": "bold",
        "baseline": "middle",
        "align": "left"
      },
      "encoding": {
        "x": {"field": "x", "type": "quantitative", "axis": null, "scale": {"domain": [0, 500]}},
        "y": {"datum": 20, "type": "quantitative", "axis": null},
        "text": {"field": "text", "type": "nominal"},
        "color": {"field": "color", "type": "nominal", "scale": null, "legend": null}
      }
    },
    {
      "width": 600,
      "height": 300,
  "data": {
    "url": "https://raw.githubusercontent.com/GurgobindSingh/FIT3179_Assignment2/main/butterfly_chart_education.csv"
  },
  "transform": [
    {
      "calculate": "datum.stage === 'primary' ? 'Primary' : datum.stage === 'secondary_lower' ? 'Secondary (Lower)' : 'Secondary (Upper)'",
      "as": "stage_label"
    },
    {
      "calculate": "datum.sex === 'male' ? 'Male' : 'Female'",
      "as": "gender_label"
    }
  ],
  "mark": {
    "type": "bar",
    "cornerRadius": 3
  },
  "encoding": {
    "x": {
      "field": "stage_label",
      "type": "nominal",
      "title": "Education Level",
      "sort": ["Primary", "Secondary (Lower)", "Secondary (Upper)"],
      "axis": {
        "labelAngle": 0,
        "labelFontSize": 12,
        "titleFontSize": 14,
        "titlePadding": 15
      }
    },
    "y": {
      "field": "average completion rate",
      "type": "quantitative",
      "title": "Average Completion Rate (%)",
      "scale": {
        "domain": [88, 100],
        "zero": false
      },
      "axis": {
        "labelFontSize": 12,
        "titleFontSize": 14,
        "titlePadding": 15,
        "grid": true,
        "gridOpacity": 0.3
      }
    },
    "y2": {
      "datum": 88
    },
    "xOffset": {
      "field": "gender_label",
      "type": "nominal",
      "sort": ["Male", "Female"]
    },
    "color": {
      "field": "gender_label",
      "type": "nominal",
      "scale": {
        "domain": ["Male", "Female"],
        "range": ["#4A90E2", "#E94B8A"]
      },
      "legend": null
    },
    "tooltip": [
      {
        "field": "gender_label",
        "type": "nominal",
        "title": "Gender"
      },
      {
        "field": "stage_label",
        "type": "nominal",
        "title": "Education Level"
      },
      {
        "field": "average completion rate",
        "type": "quantitative",
        "title": "Completion Rate (%)",
        "format": ".2f"
      }
    ]
  }
    }
  ],
  "config": {
    "view": {
      "stroke": "transparent"
    },
    "axis": {
      "domainColor": "#333",
      "tickColor": "#333"
    }
  }
}
