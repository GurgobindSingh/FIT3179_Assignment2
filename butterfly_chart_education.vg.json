{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Grouped bar chart showing average education completion rates for male and female across different education stages",
  "vconcat": [
    {
      "width": 500,
      "height": 40,
      "data": {
        "values": [
          {"text": "Average Education Completion Rates ", "x": 10, "color": "#000000"},
          {"text": "Male", "x": 370, "color": "#4A90E2"},
          {"text": " vs ", "x": 420, "color": "#000000"},
          {"text": "Female", "x": 446, "color": "#E94B8A"},
          {"text": " (2016-2022)", "x": 519, "color": "#000000"}
        ]
      },
      "mark": {
        "type": "text",
        "fontSize": 20,
        "fontWeight": "bold",
        "baseline": "middle",
        "align": "left"
      },
      "encoding": {
        "x": {"field": "x", "type": "quantitative", "axis": null, "scale": {"domain": [0, 500]}},
        "y": {"datum": 20, "type": "quantitative", "axis": null},
        "text": {"field": "text", "type": "nominal"},
        "color": {"field": "color", "type": "nominal", "scale": null, "legend": null}
      }
    },
    {
      "width": 900,
      "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/GurgobindSingh/FIT3179_Assignment2/main/butterfly_chart_education.csv"
  },
  "transform": [
    {
      "calculate": "datum.sex === 'male' ? -(datum['average completion rate'] - 88) : datum['average completion rate'] - 88",
      "as": "signed_rate"
    },
    {
      "calculate": "datum.stage === 'primary' ? 'Primary' : datum.stage === 'secondary_lower' ? 'Secondary (Lower)' : 'Secondary (Upper)'",
      "as": "stage_label"
    }
  ],
  "layer": [
    {
      "mark": "bar",
      "encoding": {
        "y": {
          "field": "stage_label",
          "type": "nominal",
          "axis": null,
          "sort": ["Primary", "Secondary (Lower)", "Secondary (Upper)"]
        },
        "x": {
          "field": "signed_rate",
          "type": "quantitative",
          "axis": {
            "title": "Average Completion Rate (%)",
            "values": [-12, -10, -8, -6, -4, -2, 0, 2, 4, 6, 8, 10, 12],
            "labelExpr": "abs(datum.value) + 88",
            "labelFontSize": 12,
            "titleFontSize": 14
          },
          "scale": {
            "domain": [-12, 12]
          }
        },
        "color": {
          "field": "sex",
          "type": "nominal",
          "scale": {
            "domain": ["male", "female"],
            "range": ["#4A90E2", "#E94B8A"]
          },
          "legend": null
        },
    "tooltip": [
      {
        "field": "gender_label",
        "type": "nominal",
        "title": "Gender"
      },
      {
        "field": "stage_label",
        "type": "nominal",
        "title": "Education Level"
      },
      {
        "field": "average completion rate",
        "type": "quantitative",
        "title": "Completion Rate (%)",
        "format": ".2f"
      }
    ]
      }
    },
    {
      "mark": {
        "type": "text",
        "baseline": "middle",
        "fontSize": 12,
        "fontWeight": "bold",
        "color": "black"
      },
      "transform": [
        {
          "calculate": "datum.signed_rate > 0 ? datum.signed_rate + 0.8 : datum.signed_rate - 0.8",
          "as": "text_position"
        }
      ],
      "encoding": {
        "y": {
          "field": "stage_label",
          "type": "nominal",
          "sort": ["Primary", "Secondary (Lower)", "Secondary (Upper)"]
        },
        "x": {
          "field": "text_position",
          "type": "quantitative"
        },
        "text": {
          "field": "average completion rate",
          "type": "quantitative",
          "format": ".1f"
        }
      }
    },
    {
      "transform": [
        {
          "aggregate": [{"op": "max", "field": "stage_label", "as": "stage_label"}],
          "groupby": ["stage_label"]
        }
      ],
      "mark": {
        "type": "text",
        "align": "center",
        "fontWeight": "bold",
        "fontSize": 14,
        "font": "sans-serif",
        "fill": "#000000"
      },
      "encoding": {
        "y": {
          "field": "stage_label",
          "type": "nominal",
          "sort": ["Primary", "Secondary (Lower)", "Secondary (Upper)"]
        },
        "x": {
          "datum": 0,
          "type": "quantitative"
        },
        "text": {
          "field": "stage_label",
          "type": "nominal"
        }
      }
    }
      ]
    }
  ],
  "config": {
    "view": {
      "stroke": "transparent"
    },
    "axis": {
      "domainColor": "#333",
      "tickColor": "#333"
    }
  }
}
