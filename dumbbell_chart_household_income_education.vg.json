{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "params": [
    {
      "name": "YearSelect",
      "value": 2022,
      "bind": {
        "input": "select",
        "options": [2016, 2019, 2020, 2022],
        "name": "Select Year: "
      }
    }
  ],
  "vconcat": [
    {
      "width": 700,
      "height": 50,
      "data": {"values": [{}]},
      "layer": [
        {
          "mark": {"type": "text", "fontSize": 16, "fontWeight": "bold", "align": "center"},
          "encoding": {
            "text": {"value": "Gap Between "},
            "x": {"value": 50},
            "y": {"value": 15},
            "color": {"value": "black"}
          }
        },
        {
          "mark": {"type": "text", "fontSize": 16, "fontWeight": "bold", "align": "center"},
          "encoding": {
            "text": {"value": "Household Income"},
            "x": {"value": 177},
            "y": {"value": 15},
            "color": {"value": "#0072B2"}
          }
        },
        {
          "mark": {"type": "text", "fontSize": 16, "fontWeight": "bold", "align": "center"},
          "encoding": {
            "text": {"value": " and "},
            "x": {"value": 268},
            "y": {"value": 15},
            "color": {"value": "black"}
          }
        },
        {
          "mark": {"type": "text", "fontSize": 16, "fontWeight": "bold", "align": "center"},
          "encoding": {
            "text": {"value": "Upper Secondary"},
            "x": {"value": 352},
            "y": {"value": 15},
            "color": {"value": "#E69F00"}
          }
        },
        {
          "mark": {"type": "text", "fontSize": 16, "fontWeight": "bold", "align": "center"},
          "encoding": {
            "text": {"value": "Completion Rate by State (2016–2022)"},
            "x": {"value": 566},
            "y": {"value": 15},
            "color": {"value": "black"}
          }
        }
      ]
    },
    {
      "hconcat": [
        {
          "width": 600,
          "height": 650,
          "data": {
            "url": "https://raw.githubusercontent.com/GurgobindSingh/FIT3179_Assignment2/main/dumbbell_chart_household_income_education.csv"
          },
          "transform": [
            {"filter": "datum.year == YearSelect"},
            {"calculate": "abs(datum.income_median_norm - datum.completion_norm)", "as": "gap"},
            {
              "window": [{"op": "rank", "as": "gap_rank"}],
              "sort": [{"field": "gap", "order": "descending"}]
            }
          ],
          "encoding": {
            "y": {
              "field": "state",
              "type": "nominal",
              "title": "State",
              "sort": {"field": "completion_norm", "op": "mean", "order": "descending"},
              "axis": {
                "labelPadding": 10,
                "labelFontSize": 11
              }
            },
            "x": {
              "type": "quantitative",
              "title": "Normalized Value (%)",
              "scale": {"domain": [0, 100]},
              "axis": {
                "grid": true,
                "tickCount": 6,
                "titleFontSize": 12,
                "labelFontSize": 11
              }
            }
          },
          "layer": [
            {
              "mark": {"type": "rule", "strokeWidth": 3},
              "encoding": {
                "x": {"field": "income_median_norm"},
                "x2": {"field": "completion_norm"},
                "color": {
                  "condition": [
                    {"test": "datum.gap_rank == 1", "value": "#FFD700"},
                    {"test": "datum.gap_rank == 2", "value": "#C0C0C0"},
                    {"test": "datum.gap_rank == 3", "value": "#CD7F32"}
                  ],
                  "value": "#666666"
                },
                "tooltip": [
                  {"field": "state", "title": "State"},
                  {"field": "year", "title": "Year"},
                  {
                    "field": "completion_norm",
                    "title": "Education Completion (Normalized)",
                    "format": ".2f"
                  },
                  {
                    "field": "income_median_norm",
                    "title": "Household Income (Normalized)",
                    "format": ".2f"
                  },
                  {
                    "field": "gap",
                    "title": "Gap (Disparity)",
                    "format": ".2f"
                  }
                ]
              }
            },
            {
              "mark": {"type": "point", "filled": true, "size": 150, "color": "#E69F00", "opacity": 1},
              "encoding": {
                "x": {"field": "completion_norm"},
                "tooltip": [
                  {"field": "state", "title": "State"},
                  {"field": "year", "title": "Year"},
                  {
                    "field": "completion_norm",
                    "title": "Education Completion (Normalized)",
                    "format": ".2f"
                  },
                  {
                    "field": "income_median_norm",
                    "title": "Household Income (Normalized)",
                    "format": ".2f"
                  },
                  {
                    "field": "gap",
                    "title": "Gap (Disparity)",
                    "format": ".2f"
                  }
                ]
              }
            },
            {
              "mark": {"type": "point", "filled": true, "size": 150, "color": "#0072B2", "opacity": 1},
              "encoding": {
                "x": {"field": "income_median_norm"},
                "tooltip": [
                  {"field": "state", "title": "State"},
                  {"field": "year", "title": "Year"},
                  {
                    "field": "income_median_norm",
                    "title": "Household Income (Normalized)",
                    "format": ".2f"
                  },
                  {
                    "field": "completion_norm",
                    "title": "Education Completion (Normalized)",
                    "format": ".2f"
                  },
                  {
                    "field": "gap",
                    "title": "Gap (Disparity)",
                    "format": ".2f"
                  }
                ]
              }
            }
          ]
        },
        {
          "width": 200,
          "height": 650,
          "data": {"values": [{}]},
          "layer": [
            {
              "mark": {
                "type": "rect",
                "color": "#f9f9f9",
                "stroke": "#cccccc",
                "strokeWidth": 1.5,
                "cornerRadius": 8,
                "x": 5,
                "x2": 290,
                "y": 5,
                "y2": 85
              }
            },
            {
              "mark": {"type": "text", "align": "left", "baseline": "top", "fontSize": 11, "fontWeight": "bold"},
              "encoding": {
                "x": {"value": 12},
                "y": {"value": 13},
                "text": {"value": "Normalization:"},
                "color": {"value": "#333"}
              }
            },
            {
              "mark": {"type": "text", "align": "left", "baseline": "top", "fontSize": 10, "font": "monospace"},
              "encoding": {
                "x": {"value": 12},
                "y": {"value": 33},
                "text": {"value": "[(x−min)/(max−min)]×100"},
                "color": {"value": "#0066cc"}
              }
            },
            {
              "mark": {"type": "text", "align": "left", "baseline": "top", "fontSize": 10, "lineHeight": 14},
              "encoding": {
                "x": {"value": 12},
                "y": {"value": 55},
                "text": {"value": "Scales both variables\nto 0–100 for direct\ncomparison."},
                "color": {"value": "#555"}
              }
            }
          ]
        }
      ]
    }
  ],
  "config": {
    "view": {"stroke": "transparent"},
    "axis": {"labelFontSize": 11, "titleFontSize": 12}
  }
}
